package me.samcefalo.sistemaiadbackend.services;import me.samcefalo.sistemaiadbackend.models.Acao;import me.samcefalo.sistemaiadbackend.models.Jogador;import me.samcefalo.sistemaiadbackend.models.Jogo;import me.samcefalo.sistemaiadbackend.models.User;import me.samcefalo.sistemaiadbackend.repositories.JogadorRepository;import me.samcefalo.sistemaiadbackend.services.exceptions.AuthorizationException;import me.samcefalo.sistemaiadbackend.services.exceptions.ObjectNotFoundException;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.data.domain.Page;import org.springframework.data.domain.PageRequest;import org.springframework.data.domain.Sort;import org.springframework.stereotype.Service;import org.springframework.transaction.annotation.Transactional;import java.util.List;@Servicepublic class JogadorService {    @Autowired    private JogadorRepository jogadorRepository;    @Autowired    private AcaoService acaoService;    @Autowired    private JogoService jogoService;    @Autowired    private UserSecurityService userSecurityService;    public Jogador find(int id) {        return jogadorRepository.findById(id).orElseThrow(                () -> new ObjectNotFoundException("Objeto n√£o encontrado. ID: " + id + ", Tipo: " + Jogador.class.getSimpleName()));    }    public Jogador insert(Jogador jogador) {        if (!userSecurityService.isAuth(jogador)) {            throw new AuthorizationException("Acesso negado.");        }        return jogadorRepository.save(jogador);    }    public Jogador update(Jogador jogador) {        if (!userSecurityService.isAuth(jogador)) {            throw new AuthorizationException("Acesso negado.");        }        Jogador jogadorNew = find(jogador.getId());        updateData(jogadorNew, jogador);        return jogadorRepository.save(jogadorNew);    }    private void updateData(Jogador jogadorNew, Jogador jogador) {        jogadorNew.setNome(jogador.getNome());        jogadorNew.setEquipe(jogador.getEquipe());        jogadorNew.setNumero(jogador.getNumero());        jogadorNew.setExpulso(jogador.isExpulso());        jogadorNew.setTitular(jogador.isTitular());    }    public void delete(int id) {        Jogador jogador = find(id);        if (!userSecurityService.isAuth(jogador)) {            throw new AuthorizationException("Acesso negado.");        }        delete(jogador);    }    private void delete(Jogador jogador) {        for (Acao acao : jogador.getAcoes()) {            acaoService.delete(acao.getId());        }        jogadorRepository.delete(jogador);    }    @Transactional(readOnly = true)    public Page<Jogador> findPage(int page, int linesPerPage, String orderBy, String direction) {        PageRequest pageRequest = PageRequest.of(page, linesPerPage,                Sort.Direction.valueOf(direction.toUpperCase()), orderBy);        return jogadorRepository.findAllByUser(pageRequest, userSecurityService.authenticatedUser());    }    @Transactional(readOnly = true)    public List<Jogador> findAll() {        return jogadorRepository.findAll();    }    @Transactional(readOnly = true)    public List<Jogador> findAllByUser(User user) {        return jogadorRepository.findAllByUser(user);    }    @Transactional    public List<Acao> findAcoes(int jogadorId) {        Jogador jogador = find(jogadorId);        return acaoService.findByJogador(jogador);    }    @Transactional(readOnly = true)    public Page<Acao> findAcoesPage(int jogadorId, int page, int linesPerPage, String orderBy, String direction) {        Jogador jogador = find(jogadorId);        PageRequest pageRequest = PageRequest.of(page, linesPerPage,                Sort.Direction.valueOf(direction.toUpperCase()), orderBy);        return acaoService.findPageByJogador(jogador, pageRequest);    }    @Transactional    public List<Jogo> findJogos(int jogadorId) {        Jogador jogador = find(jogadorId);        return jogoService.findByJogadores(jogador);    }    @Transactional(readOnly = true)    public Page<Jogo> findJogosPage(int jogadorId, int page, int linesPerPage, String orderBy, String direction) {        Jogador jogador = find(jogadorId);        PageRequest pageRequest = PageRequest.of(page, linesPerPage,                Sort.Direction.valueOf(direction.toUpperCase()), orderBy);        return jogoService.findPageByJogadores(jogador, pageRequest);    }}